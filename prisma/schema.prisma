generator client {
  provider      = "prisma-client-js"
  engineType    = "binary"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  passwordHash String
  role         String   @default("viewer")
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  createdBy    String?
}

model WeeklyGoal {
  id                     String   @id @default(cuid())
  userEmail              String // Links to User.email - matches SGA_Owner_Name__c via User.name
  weekStartDate          DateTime @db.Date // Monday of the week (DATE only)
  initialCallsGoal       Int      @default(0)
  qualificationCallsGoal Int      @default(0)
  sqoGoal                Int      @default(0)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  createdBy              String? // Email of user who created
  updatedBy              String? // Email of user who last updated

  @@unique([userEmail, weekStartDate])
  @@index([userEmail])
  @@index([weekStartDate])
}

model QuarterlyGoal {
  id        String   @id @default(cuid())
  userEmail String // Links to User.email
  quarter   String // Format: "2026-Q1", "2026-Q2", etc.
  sqoGoal   Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String? // Email of admin who set it
  updatedBy String? // Email of admin who last updated

  @@unique([userEmail, quarter])
  @@index([userEmail])
  @@index([quarter])
}

model ExploreFeedback {
  id            String   @id @default(cuid())
  userId        String?  // User email (from session.user.email)
  question      String   // The user's question
  questionId    String   // Unique ID for the question (timestamp or UUID)
  templateId    String   // Template that was selected
  feedback      String   // 'positive' or 'negative'
  comment       String?  // Required comment for negative feedback, optional for positive
  createdAt     DateTime @default(now())
  
  // Store the full query context for debugging
  compiledQuery Json?    // Store the compiled SQL and params as JSON
  executableSql String?  // Store the executable SQL (with parameters substituted) for BigQuery
  resultSummary Json?    // Store row count, execution time, visualization type, etc. as JSON
  error         String?  // Store error message if query failed (parsing error, execution error, etc.)
  
  @@index([userId])
  @@index([templateId])
  @@index([feedback])
  @@index([createdAt])
  @@index([error])
}
