# Guide 1: Generated Inventories + Standing Instructions

> **Purpose**: Create three auto-generated inventory scripts that produce deterministic documentation from code, add npm scripts to run them, and add standing instructions to `.cursorrules` so Claude Code maintains docs during every session.
> **Prerequisite**: Guide 0 complete — `docs/ARCHITECTURE.md` is current and committed.
> **Date**: 2026-02-18
> **Estimated Time**: ~1.5-2 hours in one Claude Code session

---

## ⚠️ IMPORTANT: Windows Environment

This project runs on **Windows (win32)**. All commands use **PowerShell syntax**. Do NOT use `grep`, `ls -la`, `head`, `wc -l`, `find` (Unix), or other Linux-only commands.

---

## What We're Building

### Generated Inventories (3 scripts)
Scripts that scan your codebase and produce markdown files in `docs/_generated/`. These are **deterministic** — they read code and output facts, no AI involved.

| Script | Reads | Outputs |
|--------|-------|---------|
| `scripts/generate-api-inventory.js` | Every `route.ts` under `src/app/api/` | `docs/_generated/api-routes.md` |
| `scripts/generate-model-inventory.js` | `prisma/schema.prisma` | `docs/_generated/prisma-models.md` |
| `scripts/generate-env-inventory.js` | `.env.example` | `docs/_generated/env-vars.md` |

### Standing Instructions
~40 lines added to `.cursorrules` that tell Claude Code: "if you changed X, update Y."

### Why This Matters
After Guide 0, ARCHITECTURE.md is current. But without these scripts, it will drift again the moment you add a new route. The generated inventories make route/model/env documentation **impossible to forget** because the scripts produce it from code.

---

## How to Use This Guide

1. Open Claude Code in your project root (`C:\Users\russe\Documents\Dashboard`)
2. Copy-paste each **PHASE PROMPT** one at a time
3. After each phase, Claude Code runs verification and reports results
4. Do NOT skip phases — each builds on the previous

---

## PHASE 1: Create Directory Structure + API Route Inventory Script

### Prompt

```
You are implementing Guide 1, Phase 1: Create the generated inventory infrastructure.

⚠️ RULES:
- Windows environment. PowerShell only. No Unix commands.
- Read files BEFORE writing. Do not guess file structures.
- Do NOT modify any existing source code (.ts, .tsx files). You are only CREATING new files in scripts/ and docs/_generated/.

**Step 1.1** — Create directories:
- Create `scripts/` directory in project root (if it doesn't exist)
- Create `docs/_generated/` directory (if it doesn't exist)
- Create `docs/_generated/.gitkeep` (empty file to ensure the directory is tracked)

**Step 1.2** — Read the actual codebase to understand the route structure:
Run in PowerShell:
```powershell
Get-ChildItem -Path src/app/api -Recurse -Filter "route.ts" | Select-Object FullName | Sort-Object FullName
```
Record the total count of route.ts files found.

Then read 3 sample route files to understand patterns:
- Read `src/app/api/funnel/route.ts` (first 30 lines)
- Read `src/app/api/gc-hub/advisors/route.ts` (first 30 lines)
- Read `src/app/api/dashboard-requests/route.ts` (first 30 lines)

Note what HTTP methods each exports (GET, POST, PUT, DELETE, PATCH).

**Step 1.3** — Create `scripts/generate-api-inventory.js`:

This script must:
1. Use `fs` and `path` (Node.js built-ins only — no npm dependencies)
2. Recursively find all `route.ts` files under `src/app/api/`
3. For each file, read the first 50 lines and detect which HTTP methods are exported (`export async function GET`, `export async function POST`, etc.)
4. Extract the API path from the file path (e.g., `src/app/api/funnel/route.ts` → `/api/funnel`)
5. Group routes by their top-level feature (first path segment after `/api/`)
6. Output a markdown file to `docs/_generated/api-routes.md` with:
   - A header: `# API Routes Inventory (Auto-Generated)`
   - A note: `> This file is auto-generated by \`npm run gen:api-routes\`. Do not edit manually.`
   - A timestamp: `> Generated: YYYY-MM-DD HH:mm:ss`
   - A summary: `> Total: X routes across Y feature areas`
   - For each feature group: a `## Feature Name` header and a markdown table with columns: Route | Methods | File Path

IMPORTANT: Use CommonJS (`require`) NOT ES modules (`import`). Your package.json uses `"type": "module"` but these are standalone scripts — use `.cjs` extension OR use CommonJS syntax in `.js` files. Actually — check first:

Read `package.json` and look for the `"type"` field. If `"type": "module"`, name the script `generate-api-inventory.cjs` instead.

**Step 1.4** — Run the script and verify:
```powershell
node scripts/generate-api-inventory.cjs
```
(or .js if package.json doesn't have "type": "module")

Then:
- Read `docs/_generated/api-routes.md` and confirm it exists
- Count the total routes listed — should match the count from Step 1.2
- Spot-check 3 routes: verify the methods listed match what's actually exported in those files

Report: "Phase 1 complete. API inventory script created at [path]. Generated [X] routes across [Y] feature areas. Spot-check passed for [3 routes]."
```

### Expected Outcome
- `scripts/generate-api-inventory.cjs` (or `.js`) exists and runs without errors
- `docs/_generated/api-routes.md` exists with accurate route inventory
- Route count matches actual codebase

---

## PHASE 2: Prisma Model Inventory Script

### Prompt

```
Continuing Guide 1. You are implementing Phase 2: Prisma Model Inventory Script.

⚠️ RULES:
- Windows environment. PowerShell only.
- Read files BEFORE writing.
- Do NOT modify any existing source code.
- Use the same module format (CJS/ESM) as the script you created in Phase 1.

**Step 2.1** — Read `prisma/schema.prisma` in full. Record:
- Total number of `model` declarations
- For each model: its name and field count
- Note any models with `@@map` directives (table name differs from model name)
- Note any models with relations (fields referencing other models)

**Step 2.2** — Create `scripts/generate-model-inventory.cjs` (match Phase 1 extension):

This script must:
1. Read `prisma/schema.prisma`
2. Parse out every `model` block
3. For each model, extract:
   - Model name
   - Number of fields
   - Field names and types (just the type, not decorators)
   - Whether it has `@@map` (and what the mapped table name is)
   - Relations (fields that reference other models via `@relation`)
4. Output to `docs/_generated/prisma-models.md` with:
   - Header: `# Prisma Models Inventory (Auto-Generated)`
   - Note: `> This file is auto-generated by \`npm run gen:models\`. Do not edit manually.`
   - Timestamp
   - Summary: `> Total: X models`
   - For each model: a `## ModelName` header, field count, a markdown table with columns: Field | Type | Notes (nullable, default, relation, etc.)

Keep the parser simple — regex-based is fine. Don't try to handle every Prisma edge case, just the patterns actually used in this schema.

**Step 2.3** — Run and verify:
```powershell
node scripts/generate-model-inventory.cjs
```

Then:
- Read `docs/_generated/prisma-models.md`
- Count models listed — should match the count from Step 2.1
- Spot-check 2 models: compare field lists against the actual schema

Report: "Phase 2 complete. Model inventory script created. Generated [X] models. Spot-check passed for [2 models]."
```

### Expected Outcome
- `scripts/generate-model-inventory.cjs` exists and runs clean
- `docs/_generated/prisma-models.md` accurately reflects `prisma/schema.prisma`
- Model count matches (exploration found 17 models)

---

## PHASE 3: Environment Variables Inventory Script

### Prompt

```
Continuing Guide 1. You are implementing Phase 3: Environment Variables Inventory Script.

⚠️ RULES:
- Windows environment. PowerShell only.
- Read files BEFORE writing.
- Do NOT modify any existing source code.
- Match module format from Phases 1-2.

**Step 3.1** — Read `.env.example` in full. Record:
- Total number of variables defined
- Group them by prefix/category (e.g., DATABASE_, NEXT_, GOOGLE_, SENDGRID_, etc.)
- Note which ones have placeholder values vs. empty values

**Step 3.2** — Create `scripts/generate-env-inventory.cjs`:

This script must:
1. Read `.env.example`
2. Parse each line — skip comments (#) and blank lines
3. For each variable, extract:
   - Variable name
   - Whether it has a placeholder value or is empty
   - Category (derive from prefix: DATABASE_ → Database, NEXT_ → Next.js, GOOGLE_ → Google/BigQuery, etc.)
4. Also scan `src/` for any `process.env.VARIABLE_NAME` references that are NOT in `.env.example` — these are undocumented env vars (potential drift)
5. Output to `docs/_generated/env-vars.md` with:
   - Header: `# Environment Variables Inventory (Auto-Generated)`
   - Note: `> This file is auto-generated by \`npm run gen:env\`. Do not edit manually.`
   - Timestamp
   - Summary: `> Total: X variables in .env.example, Y referenced in code`
   - A table grouped by category: Variable | Category | Has Default | Referenced In Code
   - A "⚠️ Undocumented" section listing any `process.env.*` references found in code but missing from `.env.example`

**Step 3.3** — Run and verify:
```powershell
node scripts/generate-env-inventory.cjs
```

Then:
- Read `docs/_generated/env-vars.md`
- Count variables — should match Step 3.1
- Check for any undocumented variables flagged

Report: "Phase 3 complete. Env inventory script created. [X] variables documented, [Y] undocumented references found."
```

### Expected Outcome
- `scripts/generate-env-inventory.cjs` exists and runs clean
- `docs/_generated/env-vars.md` accurately lists all env vars
- Any undocumented `process.env` references are flagged

---

## PHASE 4: NPM Scripts + Composite Command

### Prompt

```
Continuing Guide 1. You are implementing Phase 4: Add npm scripts to package.json.

⚠️ RULES:
- Read `package.json` BEFORE editing.
- Only add to the "scripts" section. Do NOT modify any existing scripts.
- Do NOT change dependencies, devDependencies, or any other section.

**Step 4.1** — Read `package.json`. Record:
- What scripts already exist
- Confirm the three inventory scripts from Phases 1-3 exist at their expected paths

**Step 4.2** — Add these scripts to the "scripts" section of `package.json`:

```json
"gen:api-routes": "node scripts/generate-api-inventory.cjs",
"gen:models": "node scripts/generate-model-inventory.cjs",
"gen:env": "node scripts/generate-env-inventory.cjs",
"gen:all": "node scripts/generate-api-inventory.cjs && node scripts/generate-model-inventory.cjs && node scripts/generate-env-inventory.cjs"
```

(Adjust file extensions if you used .js instead of .cjs in earlier phases)

Note: Use `&&` for gen:all — this works in both PowerShell and the npm script runner.

**Step 4.3** — Test each script:
```powershell
npm run gen:api-routes
npm run gen:models
npm run gen:env
npm run gen:all
```

Verify all four commands succeed without errors. Read each generated file to confirm they updated (check timestamps).

**Step 4.4** — Add `docs/_generated/` to `.gitignore`... actually, STOP.

Think about this: should generated inventory files be committed or gitignored?

Arguments for committing:
- They serve as documentation visible in the repo
- PRs show diffs when routes/models/env change
- No script execution needed to read them

Arguments for gitignoring:
- They're derived artifacts (can be regenerated)
- Could get stale if someone forgets to run gen:all

DECISION: **Commit them.** The whole point is they're documentation. Add a note in the generated files that says they're auto-generated. Do NOT add docs/_generated/ to .gitignore.

Report: "Phase 4 complete. Four npm scripts added. All run successfully. Generated files will be committed to repo."
```

### Expected Outcome
- `package.json` has 4 new scripts
- `npm run gen:all` produces all 3 inventory files
- Generated files are NOT gitignored

---

## PHASE 5: Standing Instructions in .cursorrules

### Prompt

```
Continuing Guide 1. You are implementing Phase 5: Add documentation maintenance standing instructions to .cursorrules.

⚠️ RULES:
- Read `.cursorrules` BEFORE editing.
- Do NOT modify any existing content. Only ADD a new section.
- Preserve all existing verification protocols, ground truth values, and architecture patterns.

**Step 5.1** — Read `.cursorrules` in full. Find the `## Architecture Patterns` section. Note the line number where it starts and what comes after it.

**Step 5.2** — Add the following new section AFTER `## Architecture Patterns` (before whatever section follows it). If `## Architecture Patterns` doesn't exist, add it before the last major section:

```markdown
## Documentation Maintenance — Standing Instructions

### Rule: Update Docs When You Change Code

When you add, rename, remove, or significantly modify any of the following, you MUST update the relevant documentation **in the same session** — do not defer to a later task:

| If You Changed... | Update This |
|---|---|
| API routes (`src/app/api/*/route.ts`) | Run `npm run gen:api-routes` AND update the relevant feature section in `docs/ARCHITECTURE.md` |
| Page routes (`src/app/*/page.tsx`) | Update Section 5 (Page Access Control) in `docs/ARCHITECTURE.md` |
| Prisma models (`prisma/schema.prisma`) | Run `npm run gen:models` AND update the relevant section in `docs/ARCHITECTURE.md` |
| Environment variables (`.env.example`) | Run `npm run gen:env` AND update the env vars section in `docs/ARCHITECTURE.md` |
| Permissions/roles (`src/lib/permissions.ts`) | Update Section 5 (Role Hierarchy / Permission Properties) in `docs/ARCHITECTURE.md` |
| Auth logic (`src/app/api/auth/`) | Update Section 5 (Authentication) in `docs/ARCHITECTURE.md` |
| Semantic layer (`src/lib/semantic-layer/`) | Update Section 7 (Semantic Layer) in `docs/ARCHITECTURE.md` |
| Config constants (`src/config/constants.ts`) | Update the relevant section referencing those constants |

### Generated Inventories

Three auto-generated inventory files exist at `docs/_generated/`:
- `api-routes.md` — regenerate with `npm run gen:api-routes`
- `prisma-models.md` — regenerate with `npm run gen:models`
- `env-vars.md` — regenerate with `npm run gen:env`
- Run all three: `npm run gen:all`

These are committed to the repo. Always regenerate after changing routes, models, or env vars.

### What NOT to Do
- Do NOT edit files in `docs/_generated/` manually — they are overwritten by scripts
- Do NOT skip documentation updates because "it's a small change" — small changes accumulate into drift
- Do NOT update `docs/ARCHITECTURE.md` without reading the existing section first — match the format
```

**Step 5.3** — Verify:
- Read the section you just added — confirm it's correctly placed and formatted
- Count total lines in `.cursorrules` — should be ~2,175 (was 2,135 + ~40 new lines)
- Confirm no existing content was modified:
  - Verification Protocol section still intact
  - Ground truth values unchanged
  - Architecture Patterns section still present

Report: "Phase 5 complete. Standing instructions added to .cursorrules after Architecture Patterns section. Total lines: [X]. No existing content modified."
```

### Expected Outcome
- `.cursorrules` has new `## Documentation Maintenance — Standing Instructions` section
- Lookup table maps code areas to documentation targets
- Generated inventory commands referenced
- No existing content altered

---

## PHASE 6: Final Verification + Commit

### Prompt

```
Continuing Guide 1. You are implementing Phase 6: Final verification and preparation for commit.

**Step 6.1** — Run all inventory scripts one final time:
```powershell
npm run gen:all
```
Confirm all three complete without errors.

**Step 6.2** — Verify generated files are accurate:
- Read `docs/_generated/api-routes.md` — count routes. Run:
  ```powershell
  (Get-ChildItem -Path src/app/api -Recurse -Filter "route.ts").Count
  ```
  The count in the generated file should match this number.

- Read `docs/_generated/prisma-models.md` — count models. Run:
  ```powershell
  (Select-String -Path prisma/schema.prisma -Pattern "^model ").Count
  ```
  Should match.

- Read `docs/_generated/env-vars.md` — count variables. Run:
  ```powershell
  (Get-Content .env.example | Where-Object { $_ -match "^[A-Z]" }).Count
  ```
  Should match.

**Step 6.3** — Verify no source code was modified:
```powershell
git diff --name-only
```
Should show ONLY:
- `scripts/generate-api-inventory.cjs` (new)
- `scripts/generate-model-inventory.cjs` (new)
- `scripts/generate-env-inventory.cjs` (new)
- `docs/_generated/api-routes.md` (new)
- `docs/_generated/prisma-models.md` (new)
- `docs/_generated/env-vars.md` (new)
- `package.json` (modified — scripts section only)
- `.cursorrules` (modified — new section only)

If ANY `.ts`, `.tsx`, or other source files appear — something went wrong. Revert those.

**Step 6.4** — Run TypeScript compilation to confirm nothing broke:
```powershell
npx tsc --noEmit
```
Should produce the same results as before (zero new errors).

**Step 6.5** — Report final summary:

```
Guide 1 Complete:
- API routes inventory: [X] routes across [Y] features
- Prisma models inventory: [X] models
- Env vars inventory: [X] variables, [Y] undocumented
- npm scripts: gen:api-routes, gen:models, gen:env, gen:all
- Standing instructions: added to .cursorrules
- Source code modified: NONE
- TypeScript compilation: [PASS/FAIL]
- Ready for commit: [YES/NO]
```
```

### Expected Outcome
- All counts match
- No source code modified
- TypeScript compilation clean
- Ready to commit

---

## Post-Completion Checklist

After Claude Code reports Guide 1 complete:

### Quick Scan
- [ ] Run `npm run gen:all` yourself — all 3 scripts complete?
- [ ] Open each file in `docs/_generated/` — do they look right?
- [ ] Open `.cursorrules` — find the new standing instructions section
- [ ] Check `package.json` — 4 new scripts present?

### Verify No Source Code Changes
```powershell
git diff --name-only
```
Only `scripts/`, `docs/_generated/`, `package.json`, and `.cursorrules` should appear.

### Commit
```powershell
git add scripts/ docs/_generated/ package.json .cursorrules
git commit -m "feat: add generated inventory scripts + documentation standing instructions"
```

### Ready for Guide 2
Once committed, you're ready for **Guide 2: Husky + Pre-commit Hook**.

---

## Claude Code Execution Prompt

Copy-paste this into Claude Code to execute the full guide:

```
You are executing Guide 1: Generated Inventories + Standing Instructions.

Read the implementation guide at:
C:\Users\russe\Documents\Dashboard\guide_1_inventories_standing_instructions.md

RULES — follow these strictly:
1. Read EVERY file mentioned in a phase BEFORE writing any code in that phase.
2. NEVER modify existing source code (.ts, .tsx files). You are only CREATING new files in scripts/ and docs/_generated/, and ADDING to package.json scripts and .cursorrules.
3. Windows environment — use PowerShell for all commands. No Unix commands.
4. Work phase by phase (1 through 6). Complete each phase fully before starting the next.
5. Run all verification commands shown in each phase. If a verification fails, fix the issue before moving on.
6. If you are unsure about a file's contents, READ IT. Do not guess.
7. After each phase, report results in the format shown in the guide.
8. Use CommonJS (require/module.exports) for all scripts. Check package.json "type" field first — if "type": "module", use .cjs extension for scripts.

Begin with Phase 1 now. Read the guide, then read the codebase files specified in Phase 1.
```
